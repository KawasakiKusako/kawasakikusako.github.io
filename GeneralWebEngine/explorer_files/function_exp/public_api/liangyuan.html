<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据仓库与数据挖掘在线答题及代码练习</title>
    <!-- 引入 Tailwind CSS 进行样式美化和响应式布局 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 自定义样式 */
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
        .quiz-container { max-width: 900px; margin: auto; min-height: 100vh; }
        /* 确保按钮的背景颜色和悬停效果在 JS 切换类时能正常工作 */
        .action-check { background-color: #4f46e5; } /* indigo-600 */
        .action-check:hover { background-color: #4338ca; } /* indigo-700 */
        .action-next { background-color: #6b7280; } /* gray-500 */
        .action-next:hover { background-color: #4b5563; } /* gray-600 */
        
        .fill-in-input {
            display: inline-block; width: auto; min-width: 100px; margin: 0 4px; padding: 4px 8px;
            border: 2px dashed #6b7280; border-radius: 6px; background-color: #fff; text-align: center;
            font-weight: 500; transition: all 0.2s ease-in-out;
        }
        .fill-in-input:focus { border-color: #4f46e5; outline: none; box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2); }
        .correct-answer { background-color: #d1fae5; border-color: #10b981; color: #065f46; }
        .incorrect-answer { background-color: #fee2e2; border-color: #ef4444; color: #991b1b; }
        .option-item { cursor: pointer; transition: background-color 0.15s; }
        .option-item:hover { background-color: #f3f4f6; }

        /* 确保 iframe 样式良好 */
        .code-iframe {
            min-height: 400px; /* 最小高度，保证内容可见 */
            width: 100%;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div id="app" class="quiz-container">
        <header class="text-center mb-10">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-800 tracking-tight">数据仓库与数据挖掘题库练习 (多模式增强)</h1>
            <p class="mt-2 text-lg text-gray-500">魔丸拟合-在线练习魔丸题库</p>
        </header>

        <!-- 模式和题型选择区域 - 包含新的“代码练习”模式 -->
        <div class="mb-10 p-6 bg-white rounded-xl shadow-2xl">
            <div class="mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
                <p class="text-lg font-semibold text-gray-700 mb-3">选择练习模式：</p>
                
                <!-- 模式选择 -->
                <div class="flex flex-wrap gap-4" id="mode-selection">
                    <label class="flex items-center space-x-2">
                        <input type="radio" name="practiceMode" value="random" checked onchange="handleModeChange(this.value)" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500">
                        <span class="text-sm font-medium text-gray-700">随机练题 (所有题型)</span>
                    </label>
                    <label class="flex items-center space-x-2">
                        <input type="radio" name="practiceMode" value="sequential" onchange="handleModeChange(this.value)" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500">
                        <span class="text-sm font-medium text-gray-700">顺序练题 (按题型)</span>
                    </label>
                    <!-- 新增：代码练习模式 -->
                    <label class="flex items-center space-x-2">
                        <input type="radio" name="practiceMode" value="code" onchange="handleModeChange(this.value)" class="h-4 w-4 text-green-600 focus:ring-green-500">
                        <span class="text-sm font-medium text-gray-700 font-bold">代码练习</span>
                    </label>
                </div>
            </div>

            <!-- 题型选择 (仅在顺序模式下显示) -->
            <div id="type-selection" class="hidden">
                <label for="question-type" class="block text-sm font-medium text-gray-700 mb-1">选择题型：</label>
                <select id="question-type" onchange="resetSequentialMode()" class="mt-1 block w-full sm:w-1/2 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2">
                    <!-- 选项将由 JS 加载后动态添加 -->
                </select>
            </div>

            <!-- 题目序号跳转 (仅在顺序模式下显示) -->
            <div id="sequential-nav" class="hidden mt-4 flex items-center space-x-3">
                <div class="flex items-center space-x-2">
                    <label for="question-jump-input" class="text-sm font-medium text-gray-700 whitespace-nowrap">跳转到第</label>
                    <input type="number" id="question-jump-input" min="1" onchange="jumpToQuestion(this.value)" class="w-20 text-center rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 text-sm">
                    <span id="jump-total-display" class="text-sm font-medium text-gray-700">/? 题</span>
                </div>
            </div>
        </div>

        <!-- 代码练习区域 (初始隐藏) -->
        <section id="code-practice-section" class="mb-10 p-6 bg-white rounded-xl shadow-2xl hidden">
            <h2 class="text-2xl font-bold text-gray-700 mb-4 border-b pb-2 border-gray-200">Python / Jupyter 代码练习</h2>
            <!-- 
                iframe 用于显示 static/ipynb.html 的内容。
            -->
            <iframe 
                src="static/ipynb.html" 
                title="代码练习题嵌入"
                class="code-iframe rounded-lg border-2 border-gray-300 shadow-inner"
                style="height: 600px;" 
                sandbox="allow-scripts allow-same-origin allow-popups"
            ></iframe>
            <p class="text-sm text-gray-500 mt-2">（此区域嵌入了一个交互式代码环境。如果您没有看到内容，请检查 `static/ipynb.html` 文件是否存在。）</p>
        </section>
        <!-- 结束：代码练习区域 -->


        <!-- 答题区域主体 (初始显示) -->
        <main id="quiz-main-section" class="bg-white p-6 sm:p-10 rounded-xl shadow-2xl">
            <!-- 题目区域 -->
            <div id="question-area" class="min-h-[150px]">
                <p id="loading-message" class="text-center text-xl font-semibold text-indigo-600">正在加载题库文件...</p>
            </div>

            <!-- 操作按钮区域 -->
            <div class="mt-8 pt-6 border-t border-gray-200 flex justify-between items-center space-x-4">
                <!-- 上一题按钮 (只在顺序模式下使用) -->
                <button id="prev-btn" onclick="loadPreviousQuestion()" class="px-4 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg shadow-sm hover:bg-gray-300 transition duration-150 ease-in-out disabled:opacity-50 min-w-[100px] hidden" disabled>
                    上一题
                </button>
                <!-- 检查答案 / 下一题 按钮 (合并) -->
                <button id="action-btn" onclick="handleAction()" class="flex-grow px-6 py-3 text-white font-semibold rounded-lg shadow-md transition duration-150 ease-in-out action-check disabled:opacity-60" disabled>
                    检查答案
                </button>
            </div>

            <!-- 结果反馈区域 -->
            <div id="result-area" class="mt-6 p-4 rounded-lg hidden">
                <p id="result-text" class="text-lg font-bold"></p>
                <div id="correct-answer-display" class="mt-2 text-sm text-gray-700"></div>
            </div>
        </main>
        
        <!-- 页脚版权标识 -->
        <footer class="text-center mt-10 text-sm text-gray-400">
            Github @ Kawasaki Kusako CC-BY-SA-NC 3.0
        </footer>
    </div>

    <script>
        // JS 代码部分
        let quizData = [];
        let currentQuestion = null;
        const BLANK_PLACEHOLDER = "_BLANK_";
        
        // 状态管理
        let currentMode = 'random'; // 'random', 'sequential', 或 'code'
        let currentQuestionIndex = -1; 
        let currentQuestionType = ''; 
        let randomQuestionCounter = 0; 
        let awaitingCheck = true; 
        let availableTypes = []; 

        // 文件路径配置
        const FILE_PATHS = [
            { type: 'fill_in_the_blank', path: 'static/tiankong.csv', headers: ['题号', '题目', '答案'], label: '填空题' },
            { type: 'multiple_choice', path: 'static/xuanze.csv', headers: ['题号', '题目', '选项A', '选项B', '选项C', '选项D', '答案'], label: '选择题' },
            { type: 'true_false', path: 'static/panduan.csv', headers: ['题号', '题目', '答案'], label: '判断题' }
        ];

        // DOM 元素
        const quizMainSection = document.getElementById('quiz-main-section');
        const codePracticeSection = document.getElementById('code-practice-section');

        const questionArea = document.getElementById('question-area');
        const actionBtn = document.getElementById('action-btn');
        const prevBtn = document.getElementById('prev-btn');
        const resultArea = document.getElementById('result-area');
        const resultText = document.getElementById('result-text');
        const correctAnswerDisplay = document.getElementById('correct-answer-display');
        const loadingMessage = document.getElementById('loading-message');
        const typeSelectionDiv = document.getElementById('type-selection');
        const questionTypeSelect = document.getElementById('question-type');
        const sequentialNavDiv = document.getElementById('sequential-nav');
        const questionJumpInput = document.getElementById('question-jump-input');
        const jumpTotalDisplay = document.getElementById('jump-total-display');


        /**
         * 简单 CSV 解析器：将 CSV 文本转换为对象数组。
         */
        function parseCSV(csvText, requiredHeaders) {
            const lines = csvText.trim().split('\n').map(line => line.trim()).filter(line => line.length > 0);
            if (lines.length <= 1) return [];

            const headers = lines[0].split(',').map(h => h.trim());
            const data = [];

            if (!requiredHeaders.every(h => headers.includes(h))) {
                console.error(`CSV 文件表头不匹配。要求: ${requiredHeaders.join(', ')}`);
                throw new Error(`CSV 文件表头不匹配。要求: ${requiredHeaders.join(', ')}`);
            }

            for (let i = 1; i < lines.length; i++) {
                const currentLine = lines[i];
                const values = currentLine.split(',').map(v => v.trim());
                if (values.length !== headers.length) {
                     console.warn(`行 ${i + 1} 列数不匹配，跳过。`);
                     continue;
                }
                
                let item = {};
                headers.forEach((header, index) => {
                    item[header] = values[index];
                });

                data.push(item);
            }
            return data;
        }

        /**
         * 将原始解析的 CSV 数据转换为标准题库格式。
         */
        function normalizeQuizData(rawData, type) {
            return rawData.map((item, index) => {
                const standardizedItem = {
                    id: `${type}-${item['题号'] || index + 1}`,
                    type: type,
                    question: item['题目'],
                    answer: item['答案'].trim(),
                };

                if (type === 'fill_in_the_blank') {
                    // 填空题：答案以分号分隔，转换为数组
                    standardizedItem.answer = standardizedItem.answer.split(';').map(a => a.trim()).filter(a => a.length > 0);
                } else if (type === 'multiple_choice') {
                    // 选择题：提取选项并格式化
                    standardizedItem.options = [
                        `A. ${item['选项A']}`,
                        `B. ${item['选项B']}`,
                        `C. ${item['选项C']}`,
                        `D. ${item['选项D']}`
                    ];
                }
                return standardizedItem;
            }).filter(item => item.question && item.answer);
        }

        /**
         * 设置操作按钮的文本和样式。
         */
        function setButtonState(isAwaitingCheck) {
            awaitingCheck = isAwaitingCheck;
            actionBtn.textContent = isAwaitingCheck ? '检查答案' : '下一题';
            actionBtn.classList.toggle('action-check', isAwaitingCheck);
            actionBtn.classList.toggle('action-next', !isAwaitingCheck);
        }

        /**
         * 处理操作按钮的点击事件 (检查答案/下一题)。
         */
        function handleAction() {
            if (actionBtn.disabled) return;
            if (awaitingCheck) {
                checkAnswer();
            } else {
                loadNextQuestion();
            }
        }

        /**
         * 初始化题型选择下拉菜单
         */
        function initializeTypeSelect() {
            questionTypeSelect.innerHTML = '';
            availableTypes = FILE_PATHS
                .map(fileInfo => {
                    const count = quizData.filter(q => q.type === fileInfo.type).length;
                    return { ...fileInfo, count };
                })
                .filter(info => info.count > 0); // 只显示有题目的题型

            availableTypes.forEach(typeInfo => {
                const option = document.createElement('option');
                option.value = typeInfo.type;
                option.textContent = `${typeInfo.label} (${typeInfo.count} 题)`;
                questionTypeSelect.appendChild(option);
            });
            
            // 默认选中第一个题型
            if (availableTypes.length > 0) {
                 currentQuestionType = availableTypes[0].type;
            } 
            // 初始加载第一题（如果不是代码模式）
            if (currentMode !== 'code') {
                loadNextQuestion();
            }
        }
        
        /**
         * 从文件中加载所有题库数据。
         */
        async function loadAllQuizData() {
            try {
                const loadPromises = FILE_PATHS.map(fileInfo =>
                    fetch(fileInfo.path)
                        .then(response => {
                            if (!response.ok) {
                                console.warn(`警告: 无法加载文件 ${fileInfo.path}. 状态: ${response.status}`);
                                return ""; 
                            }
                            return response.text();
                        })
                        .then(csvText => {
                            if (!csvText) return [];
                            const rawData = parseCSV(csvText, fileInfo.headers);
                            return normalizeQuizData(rawData, fileInfo.type);
                        }).catch(error => {
                            console.error(`解析文件 ${fileInfo.path} 失败:`, error);
                            return [];
                        })
                );

                const results = await Promise.all(loadPromises);
                quizData = results.flat(); 

                if (quizData.length === 0) {
                    loadingMessage.textContent = '❌ 未发现有效题目，无法开始练习。';
                    actionBtn.disabled = true;
                    prevBtn.disabled = true;
                }
                
                loadingMessage.classList.add('hidden');
                initializeTypeSelect(); 
                
            } catch (error) {
                console.error("加载题库失败:", error);
                loadingMessage.textContent = `❌ 加载题库失败：${error.message}. 请检查文件路径和格式。`;
                actionBtn.disabled = true;
                prevBtn.disabled = true;
            }
        }

        /**
         * 获取当前模式下应使用的题目列表。
         */
        function getFilteredQuestions() {
            if (currentMode === 'random') return quizData;
            return quizData.filter(q => q.type === currentQuestionType);
        }

        /**
         * 处理模式切换：控制区域显示和题目加载。
         */
        function handleModeChange(mode) {
            currentMode = mode;
            currentQuestionIndex = -1; // 索引重置
            randomQuestionCounter = 0;
            
            // 1. 控制代码练习和答题区域的显示/隐藏
            if (mode === 'code') {
                quizMainSection.classList.add('hidden');
                codePracticeSection.classList.remove('hidden');
            } else {
                quizMainSection.classList.remove('hidden');
                codePracticeSection.classList.add('hidden');
            }

            // 2. 控制顺序模式的导航控件
            const isSequential = mode === 'sequential';
            typeSelectionDiv.classList.toggle('hidden', !isSequential);
            sequentialNavDiv.classList.toggle('hidden', !isSequential);
            prevBtn.classList.toggle('hidden', !isSequential);

            // 3. 重新加载题目 (仅对答题模式有效)
            if (mode !== 'code') {
                // 如果是顺序模式，确保 currentQuestionType 已设置
                if (mode === 'sequential') {
                    currentQuestionType = questionTypeSelect.value;
                }
                loadNextQuestion(); 
            }
        }

        /**
         * 顺序模式下题型改变，重置该题型的索引
         */
        function resetSequentialMode() {
            currentQuestionType = questionTypeSelect.value;
            currentQuestionIndex = -1; // 重置索引，下一题从 0 开始
            loadNextQuestion();
        }
        
        /**
         * 跳转到指定题号
         */
        function jumpToQuestion(questionNumber) {
            if (currentMode !== 'sequential') return;

            const filteredQuestions = getFilteredQuestions();
            const total = filteredQuestions.length;
            
            let jumpIndex = parseInt(questionNumber, 10);
            if (isNaN(jumpIndex) || jumpIndex < 1 || jumpIndex > total) {
                questionJumpInput.value = currentQuestionIndex + 1;
                return;
            }

            currentQuestionIndex = jumpIndex - 1; 
            
            const nextQuestion = filteredQuestions[currentQuestionIndex];
            renderQuestion(nextQuestion);
        }

        /**
         * 随机模式：从整个题库中随机选取。
         */
        function selectRandomQuestion() {
            if (quizData.length === 0) return null;
            const randomIndex = Math.floor(Math.random() * quizData.length);
            return quizData[randomIndex];
        }

        /**
         * 加载上一道问题 (仅用于顺序模式)。
         */
        function loadPreviousQuestion() {
            if (currentMode !== 'sequential') return;

            const filteredQuestions = getFilteredQuestions();
            const total = filteredQuestions.length;

            if (total === 0) return;

            currentQuestionIndex = (currentQuestionIndex - 1 + total) % total;

            const nextQuestion = filteredQuestions[currentQuestionIndex];
            renderQuestion(nextQuestion);
        }

        /**
         * 加载下一道问题。
         */
        function loadNextQuestion() {
             if (quizData.length === 0) return;
             
            let nextQuestion = null;
            let endMessage = '';

            if (currentMode === 'random') {
                nextQuestion = selectRandomQuestion();
                randomQuestionCounter++;
            } else {
                const filteredQuestions = getFilteredQuestions();
                const total = filteredQuestions.length;

                if (total === 0) {
                     endMessage = `当前选中的题型 (${getQuestionTypeLabel(currentQuestionType)}) 题库为空。`;
                } else {
                    currentQuestionIndex = (currentQuestionIndex + 1) % total;
                    nextQuestion = filteredQuestions[currentQuestionIndex];

                    if (currentQuestionIndex === 0 && total > 0) {
                        endMessage = `当前题型已练习一轮，将从第 ${currentQuestionIndex + 1} 题重新开始。`;
                    }
                }
            }

            if (nextQuestion) {
                renderQuestion(nextQuestion);
            } else {
                questionArea.innerHTML = `<p class="text-center text-xl text-gray-500">${endMessage || '题库加载失败或已清空。'}</p>`;
                actionBtn.disabled = true;
                prevBtn.disabled = true;
                setButtonState(true);
            }
        }

        /**
         * 获取题型对应的中文名称
         */
        function getQuestionTypeLabel(type) {
            const typeInfo = FILE_PATHS.find(f => f.type === type);
            return typeInfo ? typeInfo.label : '未知题型';
        }

        /**
         * 渲染当前问题到页面上。
         */
        function renderQuestion(question) {
            currentQuestion = question;
            resultArea.classList.add('hidden');
            actionBtn.disabled = false;
            setButtonState(true); 

            const typeLabel = getQuestionTypeLabel(question.type);
            let questionHtml = `<div class="text-xl font-medium text-gray-700 leading-relaxed mb-4">${question.question}</div>`;
            
            let currentQuestionNumberDisplay;
            if (currentMode === 'sequential') {
                const filteredQuestions = getFilteredQuestions();
                const total = filteredQuestions.length;
                currentQuestionNumberDisplay = `(${typeLabel}) 第 ${currentQuestionIndex + 1}/${total} 题`;
                
                questionJumpInput.value = currentQuestionIndex + 1;
                jumpTotalDisplay.textContent = `/${total} 题`;
                prevBtn.disabled = false; 

            } else {
                currentQuestionNumberDisplay = `(随机 ${typeLabel}) 第 ${randomQuestionCounter} 题`;
            }

            // 根据题型渲染不同的输入或选择控件
            switch (question.type) {
                case 'fill_in_the_blank':
                    questionHtml = `<div class="text-xl font-medium text-gray-700 leading-relaxed">`;
                    const parts = question.question.split(BLANK_PLACEHOLDER);
                    
                    parts.forEach((part, index) => {
                        questionHtml += part.trim();
                        if (index < question.answer.length) { 
                            questionHtml += `<input type="text" data-blank-index="${index}" placeholder="请填写" class="fill-in-input focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">`;
                        }
                    });
                    questionHtml += `</div>`;
                    break;

                case 'multiple_choice':
                    questionHtml += `<div class="mt-4 space-y-3">`;
                    question.options.forEach((option) => {
                        const optionValue = option.charAt(0); 
                        questionHtml += `
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg option-item">
                                <input type="radio" name="choice" value="${optionValue}" class="h-5 w-5 text-indigo-600 focus:ring-indigo-500">
                                <span class="ml-3 text-base text-gray-800">${option}</span>
                            </label>
                        `;
                    });
                    questionHtml += `</div>`;
                    break;
                
                case 'true_false':
                    questionHtml += `<div class="mt-4 flex space-x-6">`;
                    const tfOptions = [{ label: '正确 (True)', value: 'True' }, { label: '错误 (False)', value: 'False' }];
                    tfOptions.forEach(option => {
                        questionHtml += `
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg option-item min-w-[150px]">
                                <input type="radio" name="choice" value="${option.value}" class="h-5 w-5 text-indigo-600 focus:ring-indigo-500">
                                <span class="ml-3 text-base text-gray-800">${option.label}</span>
                            </label>
                        `;
                    });
                    questionHtml += `</div>`;
                    break;
            }

            // 更新显示区域
            questionArea.innerHTML = `
                <p class="text-sm text-indigo-600 mb-2">${currentQuestionNumberDisplay}</p>
                ${questionHtml}
            `;
        }

        /**
         * 检查用户的答案是否正确。
         */
        function checkAnswer() {
            if (!currentQuestion) return;
            
            let allCorrect = true;
            let userAnswerDisplay = '';

            switch (currentQuestion.type) {
                case 'fill_in_the_blank':
                    const inputs = questionArea.querySelectorAll('input[type="text"]');
                    const correctAnswers = currentQuestion.answer;
                    const userAnswers = [];

                    inputs.forEach((input, index) => {
                        const userAnswer = input.value.trim();
                        const correctAnswer = correctAnswers[index].trim();
                        userAnswers.push(userAnswer);
                        const isCorrect = userAnswer.toLowerCase() === correctAnswer.toLowerCase(); 

                        if (isCorrect) {
                            input.classList.add('correct-answer');
                        } else {
                            input.classList.add('incorrect-answer');
                            allCorrect = false;
                        }
                        input.disabled = true;
                    });

                    userAnswerDisplay = `
                        <p class="font-semibold text-gray-800">正确答案：</p>
                        <ul class="list-disc list-inside mt-1 space-y-1">
                            ${correctAnswers.map((ans, i) => 
                                `<li class="${userAnswers[i].toLowerCase() === ans.toLowerCase() ? 'text-green-700' : 'text-red-600'}">
                                    填空 ${i + 1}: ${ans} (您的答案: ${userAnswers[i] || '未作答'})
                                </li>`
                            ).join('')}
                        </ul>
                    `;
                    break;

                case 'multiple_choice':
                case 'true_false':
                    const selectedInput = questionArea.querySelector('input[name="choice"]:checked');
                    const correctAnswerMC = String(currentQuestion.answer).trim();
                    const selectedValue = selectedInput ? selectedInput.value : '';
                    const selectedLabel = selectedInput ? selectedValue : '未作答';
                    
                    const allOptions = questionArea.querySelectorAll('input[name="choice"]');
                    allOptions.forEach(input => {
                        input.disabled = true;
                        const label = input.closest('label');
                        if (input.value === correctAnswerMC) {
                            label.classList.add('correct-answer', 'border-green-500');
                        } else if (input.checked && input.value !== correctAnswerMC) {
                            label.classList.add('incorrect-answer', 'border-red-500');
                        }
                    });

                    if (!selectedInput || selectedValue !== correctAnswerMC) {
                        allCorrect = false;
                    }
                    
                    const answerText = currentQuestion.type === 'multiple_choice' ? 
                                         currentQuestion.options.find(opt => opt.startsWith(correctAnswerMC)) || correctAnswerMC : 
                                         correctAnswerMC;

                    userAnswerDisplay = `
                        <p class="font-semibold text-gray-800">正确答案：<span class="text-green-700 font-normal">${answerText}</span></p>
                        <p class="font-semibold text-gray-800">您的选择：<span class="${allCorrect ? 'text-green-700' : 'text-red-600'} font-normal">${selectedLabel}</span></p>
                    `;
                    break;
            }

            // --- 通用结果反馈 ---
            resultArea.classList.remove('hidden');
            actionBtn.disabled = false; 
            setButtonState(false); 

            if (allCorrect) {
                resultArea.className = 'mt-6 p-4 rounded-lg bg-green-100 border border-green-500';
                resultText.textContent = '✅ 回答正确。';
                resultText.classList.remove('text-red-600');
                resultText.classList.add('text-green-700');
                correctAnswerDisplay.innerHTML = '';
            } else {
                resultArea.className = 'mt-6 p-4 rounded-lg bg-red-100 border border-red-500';
                resultText.textContent = '❌ 回答错误。';
                resultText.classList.remove('text-green-700');
                resultText.classList.add('text-red-600');
                correctAnswerDisplay.innerHTML = userAnswerDisplay;
            }
        }
        
        // 页面加载后立即尝试加载题库
        window.onload = function() {
            loadAllQuizData(); 
        };
    </script>
</body>
</html>
